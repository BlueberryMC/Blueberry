From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: acrylic-style <me@acrylicstyle.xyz>
Date: Fri, 15 Jan 2021 19:48:53 +0900
Subject: [PATCH] Client-side command support


diff --git a/src/main/java/net/minecraft/client/gui/components/CommandSuggestions.java b/src/main/java/net/minecraft/client/gui/components/CommandSuggestions.java
index cbb0034363a39c6e2aa97bac4182daf60ede86c2..cf3915675346e0d869e71167352bbb3235828bff 100644
--- a/src/main/java/net/minecraft/client/gui/components/CommandSuggestions.java
+++ b/src/main/java/net/minecraft/client/gui/components/CommandSuggestions.java
@@ -174,7 +174,13 @@ public class CommandSuggestions {
         boolean flag2 = this.commandsOnly || flag;
         int i = this.input.getCursorPosition();
         if (flag2) {
-            CommandDispatcher<SharedSuggestionProvider> commandDispatcher = this.minecraft.player.connection.getCommands();
+            // Blueberry start - client-side command completion
+            CommandDispatcher<SharedSuggestionProvider> commandDispatcher = net.blueberrymc.client.commands.ClientCommandManager.getRoot(this.minecraft.player);
+            CommandDispatcher<SharedSuggestionProvider> mojangCommandDispatcher = this.minecraft.player.connection.getCommands();
+            for (CommandNode<SharedSuggestionProvider> child : mojangCommandDispatcher.getRoot().getChildren()) {
+                commandDispatcher.getRoot().addChild(child);
+            }
+            // Blueberry end - client-side command completion
             if (this.currentParse == null) {
                 this.currentParse = commandDispatcher.parse(stringReader, this.minecraft.player.connection.getSuggestionsProvider());
             }
diff --git a/src/main/java/net/minecraft/client/gui/screens/ChatScreen.java b/src/main/java/net/minecraft/client/gui/screens/ChatScreen.java
index 3340e2ef189f529d231fed8ef4606a759fe64392..b9a13cd63c750315907e8636dfdab88744149a8e 100644
--- a/src/main/java/net/minecraft/client/gui/screens/ChatScreen.java
+++ b/src/main/java/net/minecraft/client/gui/screens/ChatScreen.java
@@ -469,6 +469,12 @@ public class ChatScreen extends Screen {
 
             Component component = Util.mapNullable(this.chatPreview.pull(s), ClientChatPreview.Preview::response);
             if (s.startsWith("/")) {
+                // Blueberry start
+                if (net.blueberrymc.client.commands.ClientCommandManager.hasCommand(s)) {
+                    net.blueberrymc.client.commands.ClientCommandManager.performCommand(this.minecraft.player.createCommandSourceStack(), s);
+                    return;
+                }
+                // Blueberry end
                 this.minecraft.player.commandSigned(s.substring(1), component);
             } else {
                 this.minecraft.player.chatSigned(s, component);
